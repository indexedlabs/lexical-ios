{"id":"lexical-ios-7nk","title":"Platform: expand AppKit/UIKit test coverage","description":"Track missing AppKit/UIKit-specific tests: clipboard (copy/cut/paste), NSTextInputClient/IME, undo/redo integration, and cross-platform AttributeUtils parity.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-15T13:59:32.609709-08:00","updated_at":"2025-12-15T20:24:33.649123-08:00","closed_at":"2025-12-15T20:24:33.649123-08:00","close_reason":"All subtasks are closed (clipboard, IME marked-text, undo/redo, AttributeUtils parity, deletion direction, Tab/Backtab, paste enablement)","labels":["appkit","tests","uikit"]}
{"id":"lexical-ios-7nk.1","title":"AppKit clipboard: implement Lexical nodes + rich text pasteboard support","description":"Implement AppKit copy/cut/paste to match UIKit behavior: set Lexical node JSON (e.g. 'x-lexical-nodes') + RTF + plain text on NSPasteboard; paste should prefer Lexical nodes when present, otherwise fallback to RTF/plain text. Likely touch Lexical/Core/Events.swift (setPasteboardAppKit / insertDataTransferForRichTextAppKit) and/or Sources/LexicalAppKit/CopyPasteHelpers.swift.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:59:49.784126-08:00","updated_at":"2025-12-15T14:20:43.211581-08:00","closed_at":"2025-12-15T14:20:43.211581-08:00","close_reason":"Implemented AppKit pasteboard support (Lexical nodes + RTF/plain fallback)","labels":["appkit","clipboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.1","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T13:59:49.784627-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.2","title":"AppKit clipboard: add NSPasteboard copy/cut/paste tests","description":"Add macOS-only tests verifying AppKit clipboard behavior: copy/cut write expected text and Lexical-node payload to a unique NSPasteboard; paste round-trips nodes when available and falls back to RTF/plain text. Mirror LexicalTests/Tests/TextViewTests.swift custom-pasteboard approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:59:58.936785-08:00","updated_at":"2025-12-15T14:23:45.903262-08:00","closed_at":"2025-12-15T14:23:45.903262-08:00","close_reason":"Added macOS-only NSPasteboard clipboard tests","labels":["appkit","clipboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.2","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T13:59:58.937179-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-7nk.2","depends_on_id":"lexical-ios-7nk.1","type":"blocks","created_at":"2025-12-15T13:59:58.937931-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.3","title":"AppKit: add NSTextInputClient/IME marked-text tests","description":"Add macOS-only tests for TextViewAppKit marked text lifecycle: setMarkedText updates editor state correctly, unmarkText commits, replacementRange handling works, and selection stays consistent. Target Sources/LexicalAppKit/TextView+NSTextInputClient.swift; consider using LexicalTests/Helpers/CrossPlatformTestHelpers.swift (TestEditorView.setMarkedText/unmarkText).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:00:10.636171-08:00","updated_at":"2025-12-15T17:54:21.836336-08:00","closed_at":"2025-12-15T17:54:21.836336-08:00","close_reason":"Added marked-text editor-state tests and AppKit marked-text integration plumbing","labels":["appkit","ime","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.3","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:00:10.636563-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.4","title":"AppKit: add undo/redo integration tests for TextViewAppKit","description":"Implemented AppKit undo/redo wiring: TextViewAppKit now caches canUndo/canRedo via commands, overrides undo/redo to dispatch Lexical history commands, and validates menu items accordingly. Added macOS-only tests in LexicalTests/Tests/AppKitUndoRedoIntegrationTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:00:21.363777-08:00","updated_at":"2025-12-15T17:54:21.33041-08:00","closed_at":"2025-12-15T17:54:21.33041-08:00","close_reason":"Undo/redo integration + tests landed; iOS simulator suite + Playground build pass","labels":["appkit","tests","undo"],"dependencies":[{"issue_id":"lexical-ios-7nk.4","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:00:21.364144-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.5","title":"AppKit: add AttributeUtils coverage (NSFont traits + paragraph style)","description":"Added macOS-only AttributeUtils tests covering NSFont family/size overrides, bold/italic traits, and paragraphStyle keys. New file: LexicalTests/Tests/AttributesUtilsAppKitTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:00:30.27508-08:00","updated_at":"2025-12-15T17:54:21.585473-08:00","closed_at":"2025-12-15T17:54:21.585473-08:00","close_reason":"AttributeUtils AppKit coverage added; iOS simulator suite + Playground build pass","labels":["appkit","attributes","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.5","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:00:30.275458-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.6","title":"AppKit: forward delete/word/line should respect direction","description":"Fixed registerRichTextAppKit to respect isBackwards payloads for .deleteCharacter/.deleteWord/.deleteLine (forward deletion now works). Added macOS-only tests in LexicalTests/Tests/AppKitDeletionDirectionTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:44:42.125474-08:00","updated_at":"2025-12-15T17:54:21.708651-08:00","closed_at":"2025-12-15T17:54:21.708651-08:00","close_reason":"Forward delete direction fix + tests added; iOS simulator suite + Playground build pass","labels":["appkit","keyboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.6","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:44:42.125926-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.7","title":"AppKit: implement Tab/Backtab key handling","description":"Updated TextViewAppKit Tab/Backtab to dispatch .indentContent/.outdentContent (instead of unused .keyTab). Added macOS-only tests in LexicalTests/Tests/AppKitTabBacktabTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:44:50.189081-08:00","updated_at":"2025-12-15T17:54:21.462006-08:00","closed_at":"2025-12-15T17:54:21.462006-08:00","close_reason":"Tab/Backtab handling + tests added; iOS simulator suite + Playground build pass","labels":["appkit","keyboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.7","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:44:50.189439-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.8","title":"Clipboard: prefer Lexical nodes over RTF when both present (decorator round-trip)","description":"Add a serializable decorator node fixture and clipboard tests that prove paste prefers Lexical node JSON over RTF when both are present (round-trips decorator), and falls back to RTF without recreating decorator nodes.","acceptance_criteria":"- New clipboard tests cover Lexical-vs-RTF preference using a decorator node fixture\\n- iOS simulator test suite passes (Lexical-Package scheme)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:34:12.600486-08:00","updated_at":"2025-12-15T17:54:03.755867-08:00","closed_at":"2025-12-15T17:54:03.755867-08:00","close_reason":"Implemented decorator clipboard preference tests; iOS suite + Playground build pass","labels":["appkit","clipboard","pasteboard","tests","uikit"],"dependencies":[{"issue_id":"lexical-ios-7nk.8","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T17:34:12.603377-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.9","title":"UIKit: add canPerformAction(paste) tests (Lexical nodes/RTF/plain)","description":"Add UIKit tests for TextView.canPerformAction(.paste:) covering Lexical nodes payload, RTF payload, and UTF8/plain payload. Update canPerformAction to explicitly allow paste when RTF is present.","acceptance_criteria":"- New unit tests cover paste enablement for Lexical nodes, RTF, and plain text\\n- iOS simulator test suite passes (Lexical-Package scheme)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:34:12.738898-08:00","updated_at":"2025-12-15T17:54:03.654341-08:00","closed_at":"2025-12-15T17:54:03.654341-08:00","close_reason":"Added paste canPerformAction tests + RTF enablement; iOS suite + Playground build pass","labels":["paste","tests","uikit"],"dependencies":[{"issue_id":"lexical-ios-7nk.9","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T17:34:12.739246-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7w8","title":"Tests: expand AppKit/UIKit platform coverage","description":"Track missing AppKit/UIKit-specific tests: clipboard (copy/cut/paste), NSTextInputClient/IME, undo/redo integration, and cross-platform AttributeUtils parity.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-15T13:59:12.901881-08:00","updated_at":"2025-12-15T14:01:10.790274-08:00","closed_at":"2025-12-15T14:01:10.790274-08:00","close_reason":"Duplicate (created accidentally; use lexical-ios-7nk)","labels":["appkit","tests","uikit"]}
{"id":"lexical-ios-biz","title":"Tooling: record perf benchmark JSONL during tests","description":"","notes":"Baseline recorded via scripts/benchmarks.py into .benchmarks/results.jsonl.\n\nReport (issue=lexical-ios-biz):\n- insert: opt_avg 0.4049s vs leg_avg 0.6964s (opt/leg=0.58)\n- seed: opt_avg 0.0743s vs leg_avg 0.0749s (opt/leg=0.99)\n- text (read-only): opt_avg 0.0919s vs leg_avg 0.0389s (opt/leg=2.36)\n- live-insert: opt_avg 1.1968s vs leg_avg 1.8020s (opt/leg=0.66)\n- live-text: opt_avg 0.0587s vs leg_avg 0.3403s (opt/leg=0.17)","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:10.05172-08:00","updated_at":"2025-12-16T22:35:44.439772-08:00","dependencies":[{"issue_id":"lexical-ios-biz","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T22:23:13.587644-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-r06","title":"LexicalLinkPlugin: add LexicalAppKit dependency on macOS","description":"Context (from indexed-ycu.5):\n- indexed RichText wants to enable LexicalLinkPlugin / LexicalAutoLinkPlugin on macOS.\n- Today, macOS consumers fail because LexicalLinkPlugin imports LexicalAppKit but the LexicalLinkPlugin target does not declare LexicalAppKit as a dependency.\n\nWhere:\n- Plugins/LexicalLinkPlugin/LexicalLinkPlugin/LinkPlugin.swift contains:\n  #elseif os(macOS)\n  import AppKit\n  import LexicalAppKit\n- Package.swift: target \"LexicalLinkPlugin\" dependencies currently only include \"Lexical\" (missing LexicalAppKit for macOS).\n\nFix:\n- Update Package.swift so target \"LexicalLinkPlugin\" depends on LexicalAppKit when platform is macOS (e.g. add .target(name: \"LexicalAppKit\", condition: .when(platforms: [.macOS])) to the dependencies list).\n\nValidation:\n- Consumer-driven (recommended): in indexed repo, remove the workaround that disables LexicalLinkPlugin on macOS and confirm:\n  - cd ios/Index/LocalPackages/RichText \u0026\u0026 swift build\n  - cd ios/Index/LocalPackages/RichText \u0026\u0026 swift test\n- Lexical regression: run the standard iOS-simulator test command for this repo (Lexical-Package scheme).","acceptance_criteria":"- LexicalLinkPlugin compiles on macOS when imported\\n- indexed RichText can enable LexicalLinkPlugin on macOS (swift build/test)\\n- iOS simulator tests still pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T16:34:00.565462-08:00","updated_at":"2025-12-15T20:24:29.155811-08:00","closed_at":"2025-12-15T20:24:29.155811-08:00","close_reason":"Added macOS-only LexicalAppKit dependency for LexicalLinkPlugin target; iOS simulator test suite + Playground build pass (macOS consumer build not run here)","external_ref":"indexed-ycu.5"}
{"id":"lexical-ios-u7r","title":"Reconciler perf: mixed-doc benchmarks + strategies","description":"Add performance benchmarks (mixed content: paragraphs + decorators + lists), collect reconciler metrics, and evaluate/iterate on reconciliation optimization strategies (Fenwick, keyed diff, block rebuild, etc).","notes":"Debugging hangs: use scripts/with-timeout.py with --sample (auto-samples last seen xctest PID) to capture stacks on idle/hard timeouts. Added step-marker prints in RapidTypingBackspaceParityTests to show progress. Verified full Lexical-Package test suite on iPhone 17 Pro (iOS 26.0) passes.","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-16T15:49:23.29905-08:00","updated_at":"2025-12-16T21:54:56.316355-08:00"}
{"id":"lexical-ios-u7r.1","title":"Perf harness: collect reconciler metrics in XCTest","description":"Add reusable test utility (EditorMetricsContainer) to capture ReconcilerMetric runs and summarize/emit metrics for performance benchmarks.","design":"Implemented reusable perf test utility:\n- Added LexicalTests/Support/PerformanceTestSupport.swift (ReconcilerMetricsCollector + ReconcilerMetricsSummary + measureWallTime).\n- Updated LexicalTests/Tests/MetricsTests.swift to use ReconcilerMetricsCollector.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test (passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:49:35.642769-08:00","updated_at":"2025-12-16T16:20:29.608313-08:00","closed_at":"2025-12-16T16:20:29.608313-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.1","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:35.643134-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.10","title":"Strategy: replace Fenwick rebuildLocationsWithFenwickRanges with diff-array","description":"Where we currently rebuild rangeCache locations via Fenwick (O((n+m)log n)), evaluate switching to the existing diff-array implementation (rebuildLocationsWithRangeDiffs, O(n+m)) and validate with perf + parity tests.","design":"Changes:\n- Fixed RangeCacheFenwick.rebuildLocationsWithRangeDiffs to match exclusive-start semantics (shift nodes strictly after startKey).\n- Switched OptimizedReconciler reorder fast path subtree shifting from rebuildLocationsWithFenwickRanges (Fenwick) to rebuildLocationsWithRangeDiffs (diff-array, O(n+m)).\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T16:23:39.146184-08:00","updated_at":"2025-12-16T21:29:31.121411-08:00","closed_at":"2025-12-16T21:29:31.121411-08:00","close_reason":"Implemented diff-array range shifts for reorder path; tests + Playground build pass","dependencies":[{"issue_id":"lexical-ios-u7r.10","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T16:23:39.146534-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.10","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-16T16:23:39.146967-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.11","title":"Perf tests: LexicalView-backed benchmarks (exercise insert-block fast path)","description":"Add an XCTest perf harness based on TestEditorView/LexicalView (not read-only context) to measure realistic editor performance and enable structural insert fast path that is disabled in read-only contexts.","design":"Implemented:\n- Added LexicalView-backed perf harness: LexicalTests/Tests/MixedDocumentLiveBenchmarkTests.swift\n  - Builds a ~50-block mixed document (paragraphs + inline decorators + decorator blocks + lists)\n  - Benchmarks block inserts at TOP/MIDDLE/END and text edits at TOP/MIDDLE/END\n  - Compares optimized profiles vs legacy (useOptimizedReconciler=false)\n  - Prints ðŸ”¥ LIVE-* lines and ReconcilerMetricsSummary per run\n\nWhy:\n- Read-only TextKit harness disables insert-block fast path; LexicalView exercises more realistic editor behavior and allows insert-block fast path.\n\nBaseline run:\n- xcodebuild ... -only-testing:LexicalTests/MixedDocumentLiveBenchmarkTests test\n- Raw log: /tmp/live-bench2.log\n\nWall times (seconds; lower is better):\n\nLIVE-INSERT (6 inserts):\n- optimized-minimal: TOP 2.6362 vs 4.3664; MIDDLE 3.0404 vs 4.1220; END 3.0489 vs 3.8447\n- optimized-balanced: TOP 2.7125 vs 3.9124; MIDDLE 3.0495 vs 4.1746; END 2.6619 vs 3.6951\n- optimized-aggressive: TOP 2.8490 vs 3.7552; MIDDLE 3.0418 vs 4.6554; END 2.6421 vs 4.1189\n\nLIVE-TEXT (10 setText edits):\n- optimized-minimal: TOP 0.5791 vs 0.6664; MIDDLE 0.4859 vs 0.3001; END 0.4925 vs 0.0755\n- optimized-balanced: TOP 0.5896 vs 0.6766; MIDDLE 0.4941 vs 0.2912; END 0.4943 vs 0.0744\n- optimized-aggressive: TOP 0.5940 vs 0.6659; MIDDLE 0.5212 vs 0.3002; END 0.5131 vs 0.0763\n\nNotes:\n- Insert-block fast path is hit in LexicalView harness (e.g., optimized-minimal TOP showed insert-block for some runs), but many reconciler runs still fall back to slow.\n- Text edits still show pathLabel=slow for optimized runs in this harness, so fastPath_TextOnly is not matching for setText updates yet.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T16:23:48.288543-08:00","updated_at":"2025-12-16T17:35:05.211589-08:00","closed_at":"2025-12-16T17:35:05.211589-08:00","close_reason":"Added LexicalView-backed benchmark tests","dependencies":[{"issue_id":"lexical-ios-u7r.11","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T16:23:48.289059-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.11","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-16T16:23:48.28957-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.12","title":"Bug: optimized text edits fall back to slow path","description":"Mixed-doc perf harnesses show optimized reconciler taking slow path for repeated TextNode.setText edits (pathLabel=slow for optimized runs) where legacy is much faster. This suggests fastPath_TextOnly (and/or central aggregation text paths) is not matching for these updates.\n\nSuspected causes to investigate:\n- changedTextKeys count != 1 due to additional text mutations/transforms\n- rangeCache/textStorage mismatch causing fastPath_TextOnly bounds guards to fail\n- selection/dirtyType interactions forcing full rebuild\n\nGoal:\n- Make setText-only edits hit the text-only fast path (text-only-min-replace or multi-text) in mixed docs; verify via MixedDocumentLiveBenchmarkTests logs and improved wall times.\n\nRefs:\n- /tmp/mixed-bench.log (read-only)\n- /tmp/live-bench2.log (LexicalView)","design":"Fixes:\n\n- Fixed optimized text-only fast path comparing against latest node snapshots by using fromLatest=false for TextNode.getTextPart and ElementNode.getChildrenKeys in OptimizedReconciler.\n- Cached DFS order + index map together (Editor.cachedDFSOrderAndIndex) and tightened invalidation to structural edits only.\n- Prevented TextKit hangs by clamping fixAttributes ranges (applyInstructions/applyInstructionsWithModernBatching and fastPath_TextOnly minimal replace).\n- Fixed central aggregation text-only planner (plan_TextOnly_Multi) to bail on structural changes (node count mismatch, parent/children changes) so merges/deletes fall back safely.\n- Added regression test to ensure simple TextNode.setText hits text-only fast path: LexicalTests/Tests/OptimizedReconcilerTextFastPathTests.swift.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T17:36:32.923311-08:00","updated_at":"2025-12-16T21:24:08.375783-08:00","closed_at":"2025-12-16T21:24:08.375783-08:00","close_reason":"Fixed (text-only fast path restored + structural-safe aggregation + TextKit fixAttributes clamping); full iOS simulator test suite + Playground build pass","dependencies":[{"issue_id":"lexical-ios-u7r.12","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T17:36:32.923646-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.12","depends_on_id":"lexical-ios-u7r.11","type":"discovered-from","created_at":"2025-12-16T17:36:32.924312-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.13","title":"Bug: caret/selection lags during rapid typing","description":"When typing quickly in LexicalView, text appears but caret/cursor visually lags behind (doesn't reach end-of-line as fast as text insertion). Investigate selection reconciliation vs TextKit layout/ensureLayout timing; add repro test if possible and measure impact.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-16T22:23:33.135835-08:00","updated_at":"2025-12-16T22:23:33.135835-08:00","dependencies":[{"issue_id":"lexical-ios-u7r.13","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T22:23:33.136217-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.2","title":"Perf tests: seed 50-block mixed document (paragraph/list/decorator)","description":"Add XCTest that constructs a large mixed-content document (lots of text paragraphs, inline+block decorators, list nodes) and records reconciler metrics.","design":"Added mixed-content seed benchmark:\n- Added LexicalTests/Tests/MixedDocumentBenchmarkTests.swift testMixedDocumentSeedBenchmarkQuick (50-block doc: long paragraphs, inline+block decorators, list nodes).\n\nNotes:\n- Benchmarks run on read-only TextKit context for deterministic reconciler-only measurement (matches existing benchmark patterns).\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' -only-testing:LexicalTests/MixedDocumentBenchmarkTests/testMixedDocumentSeedBenchmarkQuick test (passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:49:43.167634-08:00","updated_at":"2025-12-16T16:20:36.631932-08:00","closed_at":"2025-12-16T16:20:36.631932-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.2","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:43.168009-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.3","title":"Perf tests: insert/edit at top/middle/end in mixed document","description":"Add benchmarks for repeated inserts/edits at document top, middle, and end (large mixed-content doc) and capture reconciler metrics + op counts.","design":"Added mixed-content edit/insert benchmarks:\n- Added LexicalTests/Tests/MixedDocumentBenchmarkTests.swift\n  - testMixedDocumentInsertBenchmarkTopMiddleEndQuick (repeated inserts at top/middle/end; inserted block types vary: paragraph/decorator-block/list).\n  - testMixedDocumentTextInsertBenchmarkTopMiddleEndQuick (text inserts at start/middle/end).\n\nFix discovered by benchmarks:\n- Fixed Lexical/Helper/PlanDiff.swift computePartDiffs to account for newly-inserted nodes missing from prev range cache (prev lengths treated as 0). This prevented incorrect optimized reconciler early-out path 'prepost-gated-noop' on structural inserts.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' -only-testing:LexicalTests/MixedDocumentBenchmarkTests test (passed).\n- Full suite: xcodebuild ... Lexical-Package test (passed).\n- Playground build: xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build (passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:49:51.127188-08:00","updated_at":"2025-12-16T16:20:44.229375-08:00","closed_at":"2025-12-16T16:20:44.229375-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.3","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:51.127532-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.4","title":"Baseline: run mixed-doc benchmarks across reconciler flag variations","description":"Run new perf tests across key FeatureFlags combos (Fenwick delta, central aggregation, insert-block fenwick, keyed diff, block rebuild) and capture summary output for comparison.","design":"Run:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' -only-testing:LexicalTests/MixedDocumentBenchmarkTests test\n- Raw log saved: /tmp/mixed-bench.log\n\nWall times (seconds; lower is better):\n\nSEED (build ~50-block mixed doc):\n- optimized-minimal: opt 0.0933 / legacy 0.0962\n- optimized-balanced: opt 0.0810 / legacy 0.0972\n- optimized-aggressive: opt 0.1071 / legacy 0.0923\n\nINSERT (6 block inserts; read-only harness):\n- optimized-minimal: TOP 0.4385 vs 1.1796; MIDDLE 0.4153 vs 0.8575; END 0.4588 vs 0.7132\n- optimized-balanced: TOP 0.4179 vs 0.6723; MIDDLE 0.4869 vs 0.6588; END 0.4003 vs 0.6842\n- optimized-aggressive: TOP 0.4025 vs 0.6572; MIDDLE 0.4042 vs 0.6551; END 0.5803 vs 0.6669\n\nTEXT (10 setText edits):\n- optimized-minimal: TOP 0.7547 vs 0.0474; MIDDLE 0.7638 vs 0.0638; END 0.7371 vs 0.0397\n- optimized-balanced: TOP 0.9452 vs 0.0453; MIDDLE 1.4822 vs 0.1007; END 0.9957 vs 0.0610\n- optimized-aggressive: TOP 0.8998 vs 0.0608; MIDDLE 1.0337 vs 0.0693; END 1.0884 vs 0.1258\n\nObservations:\n- Optimized reconciler reports pathLabel=slow for all insert/text runs in this read-only harness, so these numbers largely measure full-document rebuild cost.\n- Insert results are plausible (insert-block fast path is disabled for LexicalReadOnlyTextKitContext), but text edits being slow suggests fastPath_TextOnly is not matching for this harness and needs investigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:49:58.049133-08:00","updated_at":"2025-12-16T17:19:06.861902-08:00","closed_at":"2025-12-16T17:19:06.861902-08:00","close_reason":"Captured baseline benchmark output","dependencies":[{"issue_id":"lexical-ios-u7r.4","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:58.049504-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.5","title":"Analysis: Fenwick tree usage in optimized reconciler","description":"Review OptimizedReconciler + RangeCacheFenwick/Incremental to understand current Fenwick-based delta propagation; identify hot paths, allocation patterns, and opportunities to reduce work.","design":"Findings so far (Fenwick + reconciler):\n\n- RangeCache shifting:\n  - Legacy path updates absolute locations by walking the tree (see Lexical/TextKit/RangeCache.swift updateNodeLocationFor), effectively O(n) for large docs.\n  - Optimized paths use range-shift batching helpers:\n    - Lexical/Helper/RangeCacheIncremental.swift applyIncrementalLocationShifts: diff-array + single prefix pass (O(n + m)).\n    - Lexical/Helper/RangeCacheFenwick.swift rebuildLocationsWithFenwickRanges: Fenwick tree range-add + per-key prefixSum (O((n + m) log n)).\n    - Note: RangeCacheFenwick.swift also contains rebuildLocationsWithRangeDiffs (diff-array O(n + m)) but it is currently unused.\n\n- DFS/order indexing:\n  - OptimizedReconciler.fenwickOrderAndIndex(editor:) uses Editor.cachedDFSOrder(), which currently sorts the *entire* rangeCache by location each time the cache is invalidated (Lexical/Core/Editor.swift cachedDFSOrder + Lexical/Helper/RangeCacheIndexing.swift). This is O(n log n) and looks like a likely hot cost for large docs.\n  - The optimized reconciler invalidates this cache in multiple fast paths even when structure does not change (e.g. text-only / prepost-only paths), which may be avoidable.\n\n- Read-only vs live editor behavior:\n  - fastPath_InsertBlock is explicitly disabled for LexicalReadOnlyTextKitContext (OptimizedReconciler.swift) to preserve parity. This means benchmark tests built on read-only contexts will *not* exercise structural insert fast path performance.\n\n- Bug discovered while wiring perf tests:\n  - computePartDiffs previously ignored inserted nodes missing from the prev range cache, which could make 'prepost-gated-noop' incorrectly early-out on real structural inserts. Fixed in Lexical/Helper/PlanDiff.swift.\n\nNext steps to investigate:\n- Reduce cachedDFSOrder invalidations (only invalidate on structural changes) and measure impact on new MixedDocumentBenchmarkTests.\n- Consider replacing rebuildLocationsWithFenwickRanges usages with diff-array variant (rebuildLocationsWithRangeDiffs) where applicable.\n- Consider caching/reusing the indexOf map alongside cachedDFSOrder to avoid rebuilding the dictionary each update.\n- Add a LexicalView-backed perf test harness to measure real editor path (where structural insert fast path is enabled).","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-16T15:50:06.956742-08:00","updated_at":"2025-12-16T16:23:16.733308-08:00","dependencies":[{"issue_id":"lexical-ios-u7r.5","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:06.957089-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.6","title":"Strategy: optimize Fenwick delta aggregation + reuse buffers","description":"Investigate reducing allocations/work in Fenwick delta planning (e.g., reuse arrays, avoid dictionary merges, fast-path small edit counts) and validate with mixed-doc benchmarks.","notes":"Implemented buffer reuse + fewer allocations in incremental range shifts:\n- Added Editor.locationShiftDiffScratch and threaded it into applyIncrementalLocationShifts.\n- applyIncrementalLocationShifts now reuses diff buffer + resets only touched indices; avoids diff.allSatisfy scan.\n- applyLengthDelta/applyLengthDeltasBatch now walk parent chain (no getParents array alloc) and reserve dictionary capacity.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-16T15:50:16.345521-08:00","updated_at":"2025-12-16T22:02:56.558791-08:00","dependencies":[{"issue_id":"lexical-ios-u7r.6","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:16.345859-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.7","title":"Strategy: tighten range cache updates for mixed-block edits","description":"Look for cases where we rebuild/shift too much of RangeCache during block inserts/deletes; explore smaller-scope invalidation and verify selection mapping correctness with parity tests.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:50:25.033678-08:00","updated_at":"2025-12-16T15:50:25.033678-08:00","dependencies":[{"issue_id":"lexical-ios-u7r.7","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:25.034059-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.8","title":"Strategy: reduce TextStorage mutations (batch inserts/deletes/attrs)","description":"Audit optimized reconciler instruction application; look for opportunities to coalesce adjacent delete/insert/attribute operations and reduce attributed string churn.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:50:30.337856-08:00","updated_at":"2025-12-16T15:50:30.337856-08:00","dependencies":[{"issue_id":"lexical-ios-u7r.8","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:30.338253-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.9","title":"Strategy: reduce cachedDFSOrder work (avoid invalidation + cache index map)","description":"Investigate removing unnecessary dfsOrderCache invalidations on non-structural edits and caching the indexOf map alongside the order to avoid O(n log n) sort + O(n) dictionary rebuild on each update.","design":"Changes:\n\n- Cached DFS order and its index map together to avoid rebuilding [NodeKey: Int] on every Fenwick shift (Editor.cachedDFSOrderAndIndex).\n- Reduced unnecessary dfsOrderCache invalidations for non-structural edits (text-only, pre/post attrs-only, and central aggregation paths).\n- Moved DFS-order invalidation to structural mutation points (insert-block success, reorder fast path, coalesced replace, prune helpers, fresh hydration + slow path).\n- Ensured correctness for delete-block Fenwick shifting by capturing DFS order/index before pruning removed keys, then applying shifts after prune.\n- Invalidate DFS caches when Editor.featureFlags is reassigned (Playground flag toggles).\n\nKey files:\n- Lexical/Core/Editor.swift\n- Lexical/Core/OptimizedReconciler.swift\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T16:23:28.998704-08:00","updated_at":"2025-12-16T17:14:48.175737-08:00","closed_at":"2025-12-16T17:14:48.175737-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.9","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T16:23:28.999378-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.9","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-16T16:23:28.999968-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-wfq","title":"Audit and remove emoji-prefixed debug logs","description":"Search for leftover debug logging thatâ€™s prefixed with emojis (e.g. ðŸ”¥) in app/library code and remove it (or gate behind verbose logging/DEBUG where appropriate).\\n\\nInitial grep: there are ðŸ”¥ prints in e.g. Playground/LexicalPlayground/ToolbarPlugin.swift, Lexical/LexicalView/LexicalView.swift, Lexical/Core/Selection/RangeSelection.swift, Sources/LexicalAppKit/*, Lexical/Helper/ReconcilerShadowCompare.swift.","acceptance_criteria":"No emoji-prefixed debug logs remain in production code (Playground/, Lexical/, Plugins/, Sources/) unless explicitly gated for diagnostics. iOS Simulator tests (Lexical-Package) and Playground build both pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:28:07.876511-08:00","updated_at":"2025-12-15T20:24:21.680267-08:00","closed_at":"2025-12-15T20:24:21.680267-08:00","close_reason":"Removed emoji-prefixed debug logs/print statements; iOS simulator test suite + Playground build pass"}
