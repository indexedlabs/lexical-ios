{"id":"lexical-ios-03k","title":"Playground iOS: add mac-style Lexical debug snapshot panel","description":"Extend the iOS Playground debug panel to include a mac-style debug snapshot (selection/native selection/layout/range cache + action log) and live reconciler metrics, with copy-to-clipboard.","notes":"Changes planned: NodeHierarchyViewPlugin gains a Snapshot tab with Copy State output including native selection + layout + range cache; hook reconciler metrics via EditorConfig.metricsContainer; allow toggling capture flags.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:59:50.112016-08:00","updated_at":"2025-12-17T21:03:39.983666-08:00","closed_at":"2025-12-17T21:03:39.983666-08:00","close_reason":"Implemented Snapshot panel + reconciler metrics in iOS Playground"}
{"id":"lexical-ios-36y","title":"AppKit: selection interception swallows first navigation after typing","description":"After insertText, TextViewAppKit sets interceptNextSelectionChangeAndReplaceWithRange to keep the caret stable. That intercept can accidentally replace the very next user navigation selection update (e.g. Cmd+Shift+Left) with the prior caret range, making the first key press appear to do nothing.","notes":"Fix in TextView.setSelectedRange: only intercept collapsed caret updates, and skip interception for navigation keyCodes (arrows/home/end/page up/down). Regression test: AppKitCommandShiftArrowSelectionTests types then presses Cmd+Shift+Left and expects full-line selection on first press.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T20:23:43.198678-08:00","updated_at":"2025-12-17T20:23:53.961718-08:00","closed_at":"2025-12-17T20:23:53.961718-08:00","close_reason":"Fixed interception to not swallow navigation selection; added regression test","dependencies":[{"issue_id":"lexical-ios-36y","depends_on_id":"lexical-ios-vgc","type":"discovered-from","created_at":"2025-12-17T20:23:43.199439-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-3kx","title":"AppKit: make placeholder/decorator subviews click-through for focus","description":"STTextViewAppKit overrides hitTest(_:) to proxy clicks through utility subviews (selection overlays / fragment views) back to the main text view, while allowing attachment views to handle their own events. In LexicalAppKit, TextViewAppKit contains a placeholder NSTextField subview (and may host decorator/attachment views). Audit whether these subviews can steal mouse events / first-responder focus. If so, make them click-through (e.g. override hitTest(_:), or adjust subview hit-testing) so the NSTextView remains the event target and keyboard shortcuts work reliably.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:39:35.86986-08:00","updated_at":"2025-12-17T16:57:04.774988-08:00","closed_at":"2025-12-17T16:57:04.774988-08:00","close_reason":"Make placeholder hit-testing click-through to keep NSTextView focus","labels":["appkit","focus","hittest"],"dependencies":[{"issue_id":"lexical-ios-3kx","depends_on_id":"lexical-ios-wrn","type":"discovered-from","created_at":"2025-12-17T16:39:35.870654-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-6w0","title":"Bug: Cmd+C / Cmd+V not working in LexicalDemoMac","description":"In the SwiftPM AppKit demo (LexicalDemoMac), context-menu Copy/Paste works but keyboard shortcuts Cmd+C / Cmd+V do not. Investigate responder chain, main menu, firstResponder, validateUserInterfaceItem, and whether NSTextView is acting as field editor. Fix so standard shortcuts work reliably.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T16:24:04.427863-08:00","updated_at":"2025-12-17T16:36:32.923967-08:00","closed_at":"2025-12-17T16:36:32.923967-08:00","close_reason":"Fixed: TextViewAppKit handles Cmd+C/V","dependencies":[{"issue_id":"lexical-ios-6w0","depends_on_id":"lexical-ios-u7r.25","type":"discovered-from","created_at":"2025-12-17T16:24:04.429678-08:00","created_by":"mh"}]}
{"id":"lexical-ios-7n8","title":"Editor: auto-scroll caret into view when it moves offscreen (Enter/new selection)","description":"When pressing Enter (or any edit/selection change) moves the insertion point below/above the currently visible viewport, the editor should automatically scroll to keep the caret visible. Implement for UIKit (LexicalView/TextView) and AppKit (LexicalAppKit) where applicable; add regression tests (likely UI-ish) that insert enough lines to overflow, press Enter, and assert the visible range includes the caret (or that scroll offset changed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T23:53:29.488399-08:00","updated_at":"2025-12-18T00:45:50.261869-08:00","closed_at":"2025-12-18T00:45:50.261869-08:00","close_reason":"Implemented caret auto-scroll in TextViewAppKit.applySelection and UIKit TextView.requestScrollSelectionToVisible; added tests"}
{"id":"lexical-ios-7nk","title":"Platform: expand AppKit/UIKit test coverage","description":"Track missing AppKit/UIKit-specific tests: clipboard (copy/cut/paste), NSTextInputClient/IME, undo/redo integration, and cross-platform AttributeUtils parity.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-15T13:59:32.609709-08:00","updated_at":"2025-12-15T20:24:33.649123-08:00","closed_at":"2025-12-15T20:24:33.649123-08:00","close_reason":"All subtasks are closed (clipboard, IME marked-text, undo/redo, AttributeUtils parity, deletion direction, Tab/Backtab, paste enablement)","labels":["appkit","tests","uikit"]}
{"id":"lexical-ios-7nk.1","title":"AppKit clipboard: implement Lexical nodes + rich text pasteboard support","description":"Implement AppKit copy/cut/paste to match UIKit behavior: set Lexical node JSON (e.g. 'x-lexical-nodes') + RTF + plain text on NSPasteboard; paste should prefer Lexical nodes when present, otherwise fallback to RTF/plain text. Likely touch Lexical/Core/Events.swift (setPasteboardAppKit / insertDataTransferForRichTextAppKit) and/or Sources/LexicalAppKit/CopyPasteHelpers.swift.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:59:49.784126-08:00","updated_at":"2025-12-15T14:20:43.211581-08:00","closed_at":"2025-12-15T14:20:43.211581-08:00","close_reason":"Implemented AppKit pasteboard support (Lexical nodes + RTF/plain fallback)","labels":["appkit","clipboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.1","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T13:59:49.784627-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.2","title":"AppKit clipboard: add NSPasteboard copy/cut/paste tests","description":"Add macOS-only tests verifying AppKit clipboard behavior: copy/cut write expected text and Lexical-node payload to a unique NSPasteboard; paste round-trips nodes when available and falls back to RTF/plain text. Mirror LexicalTests/Tests/TextViewTests.swift custom-pasteboard approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T13:59:58.936785-08:00","updated_at":"2025-12-15T14:23:45.903262-08:00","closed_at":"2025-12-15T14:23:45.903262-08:00","close_reason":"Added macOS-only NSPasteboard clipboard tests","labels":["appkit","clipboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.2","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T13:59:58.937179-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-7nk.2","depends_on_id":"lexical-ios-7nk.1","type":"blocks","created_at":"2025-12-15T13:59:58.937931-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.3","title":"AppKit: add NSTextInputClient/IME marked-text tests","description":"Add macOS-only tests for TextViewAppKit marked text lifecycle: setMarkedText updates editor state correctly, unmarkText commits, replacementRange handling works, and selection stays consistent. Target Sources/LexicalAppKit/TextView+NSTextInputClient.swift; consider using LexicalTests/Helpers/CrossPlatformTestHelpers.swift (TestEditorView.setMarkedText/unmarkText).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:00:10.636171-08:00","updated_at":"2025-12-15T17:54:21.836336-08:00","closed_at":"2025-12-15T17:54:21.836336-08:00","close_reason":"Added marked-text editor-state tests and AppKit marked-text integration plumbing","labels":["appkit","ime","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.3","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:00:10.636563-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.4","title":"AppKit: add undo/redo integration tests for TextViewAppKit","description":"Implemented AppKit undo/redo wiring: TextViewAppKit now caches canUndo/canRedo via commands, overrides undo/redo to dispatch Lexical history commands, and validates menu items accordingly. Added macOS-only tests in LexicalTests/Tests/AppKitUndoRedoIntegrationTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:00:21.363777-08:00","updated_at":"2025-12-15T17:54:21.33041-08:00","closed_at":"2025-12-15T17:54:21.33041-08:00","close_reason":"Undo/redo integration + tests landed; iOS simulator suite + Playground build pass","labels":["appkit","tests","undo"],"dependencies":[{"issue_id":"lexical-ios-7nk.4","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:00:21.364144-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.5","title":"AppKit: add AttributeUtils coverage (NSFont traits + paragraph style)","description":"Added macOS-only AttributeUtils tests covering NSFont family/size overrides, bold/italic traits, and paragraphStyle keys. New file: LexicalTests/Tests/AttributesUtilsAppKitTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:00:30.27508-08:00","updated_at":"2025-12-15T17:54:21.585473-08:00","closed_at":"2025-12-15T17:54:21.585473-08:00","close_reason":"AttributeUtils AppKit coverage added; iOS simulator suite + Playground build pass","labels":["appkit","attributes","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.5","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:00:30.275458-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.6","title":"AppKit: forward delete/word/line should respect direction","description":"Fixed registerRichTextAppKit to respect isBackwards payloads for .deleteCharacter/.deleteWord/.deleteLine (forward deletion now works). Added macOS-only tests in LexicalTests/Tests/AppKitDeletionDirectionTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:44:42.125474-08:00","updated_at":"2025-12-15T17:54:21.708651-08:00","closed_at":"2025-12-15T17:54:21.708651-08:00","close_reason":"Forward delete direction fix + tests added; iOS simulator suite + Playground build pass","labels":["appkit","keyboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.6","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:44:42.125926-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.7","title":"AppKit: implement Tab/Backtab key handling","description":"Updated TextViewAppKit Tab/Backtab to dispatch .indentContent/.outdentContent (instead of unused .keyTab). Added macOS-only tests in LexicalTests/Tests/AppKitTabBacktabTests.swift. iOS validation: Playground build OK; full iOS test suite currently failing (29 baseline failures), so leaving issue in_progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T14:44:50.189081-08:00","updated_at":"2025-12-15T17:54:21.462006-08:00","closed_at":"2025-12-15T17:54:21.462006-08:00","close_reason":"Tab/Backtab handling + tests added; iOS simulator suite + Playground build pass","labels":["appkit","keyboard","tests"],"dependencies":[{"issue_id":"lexical-ios-7nk.7","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T14:44:50.189439-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.8","title":"Clipboard: prefer Lexical nodes over RTF when both present (decorator round-trip)","description":"Add a serializable decorator node fixture and clipboard tests that prove paste prefers Lexical node JSON over RTF when both are present (round-trips decorator), and falls back to RTF without recreating decorator nodes.","acceptance_criteria":"- New clipboard tests cover Lexical-vs-RTF preference using a decorator node fixture\\n- iOS simulator test suite passes (Lexical-Package scheme)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:34:12.600486-08:00","updated_at":"2025-12-15T17:54:03.755867-08:00","closed_at":"2025-12-15T17:54:03.755867-08:00","close_reason":"Implemented decorator clipboard preference tests; iOS suite + Playground build pass","labels":["appkit","clipboard","pasteboard","tests","uikit"],"dependencies":[{"issue_id":"lexical-ios-7nk.8","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T17:34:12.603377-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7nk.9","title":"UIKit: add canPerformAction(paste) tests (Lexical nodes/RTF/plain)","description":"Add UIKit tests for TextView.canPerformAction(.paste:) covering Lexical nodes payload, RTF payload, and UTF8/plain payload. Update canPerformAction to explicitly allow paste when RTF is present.","acceptance_criteria":"- New unit tests cover paste enablement for Lexical nodes, RTF, and plain text\\n- iOS simulator test suite passes (Lexical-Package scheme)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:34:12.738898-08:00","updated_at":"2025-12-15T17:54:03.654341-08:00","closed_at":"2025-12-15T17:54:03.654341-08:00","close_reason":"Added paste canPerformAction tests + RTF enablement; iOS suite + Playground build pass","labels":["paste","tests","uikit"],"dependencies":[{"issue_id":"lexical-ios-7nk.9","depends_on_id":"lexical-ios-7nk","type":"parent-child","created_at":"2025-12-15T17:34:12.739246-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-7w8","title":"Tests: expand AppKit/UIKit platform coverage","description":"Track missing AppKit/UIKit-specific tests: clipboard (copy/cut/paste), NSTextInputClient/IME, undo/redo integration, and cross-platform AttributeUtils parity.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-15T13:59:12.901881-08:00","updated_at":"2025-12-15T14:01:10.790274-08:00","closed_at":"2025-12-15T14:01:10.790274-08:00","close_reason":"Duplicate (created accidentally; use lexical-ios-7nk)","labels":["appkit","tests","uikit"]}
{"id":"lexical-ios-a23","title":"Task: Auto-scroll caret into view on Enter","description":"In Lexical editors, when pressing Enter inserts a new paragraph beyond the currently visible area, the caret can move offscreen without the scroll view following it. Update the AppKit (LexicalAppKit / LexicalDemoMac) and iOS (LexicalView) frontends to keep the insertion point visible after newline/paragraph insertion and after any selection changes that move the caret.\n\nLikely fix: call scroll-to-selection / scrollRangeToVisible after selection updates and/or after reconciler applies text/selection changes, but avoid fighting user scroll/selection during drag.","acceptance_criteria":"- In LexicalDemoMac: repeatedly pressing Enter at the end keeps the caret visible (auto-scrolls as needed).\n- In LexicalPlayground (iOS): pressing Return at the end keeps the caret visible.\n- Add at least one regression test (platform-appropriate) covering Enter causing caret to move beyond visible bounds.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T16:44:45.43215-08:00","updated_at":"2025-12-17T16:51:19.44293-08:00","closed_at":"2025-12-17T16:51:19.44293-08:00","close_reason":"Auto-scroll caret into view on newline insertion","dependencies":[{"issue_id":"lexical-ios-a23","depends_on_id":"lexical-ios-6w0","type":"discovered-from","created_at":"2025-12-17T16:44:45.43287-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-biz","title":"Tooling: record perf benchmark JSONL during tests","description":"","notes":"Baseline recorded via scripts/benchmarks.py into .benchmarks/results.jsonl.\\n\\nReport (issue=lexical-ios-biz):\\n- insert: opt_avg 0.4049s vs leg_avg 0.6964s (opt/leg=0.58)\\n- seed: opt_avg 0.0743s vs leg_avg 0.0749s (opt/leg=0.99)\\n- text (read-only): opt_avg 0.0919s vs leg_avg 0.0389s (opt/leg=2.36)\\n- live-insert: opt_avg 1.1968s vs leg_avg 1.8020s (opt/leg=0.66)\\n- live-text: opt_avg 0.0587s vs leg_avg 0.3403s (opt/leg=0.17)\\n\\nAdded docs/PerformanceBenchmarks.md and expanded scripts/benchmarks.py report output (tag/git/dirty columns) + --scenario filter for easier bd-issue correlation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:10.05172-08:00","updated_at":"2025-12-17T01:20:46.887583-08:00","closed_at":"2025-12-17T01:20:46.887583-08:00","close_reason":"Implemented benchmark JSONL collection tooling + docs; benchmarks.py report supports tag/git/scenario; verified via recorded runs","dependencies":[{"issue_id":"lexical-ios-biz","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T22:23:13.587644-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-cmg","title":"iOS: add Debug State overlay (selection/layout/rangeCache) like macOS","description":"Port the macOS debug state view (selection, native selection, visible ranges, range cache, last actions) to iOS (LexicalPlayground +/or LexicalView). Goal: quick on-device debugging for selection mapping/reconciler issues without external logging. Consider a floating panel or modal in Playground toggled via Flags.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T23:53:49.293678-08:00","updated_at":"2025-12-17T23:53:49.293678-08:00"}
{"id":"lexical-ios-eie","title":"AppKit: route command keyDown via NSTextView and test Cmd+Right collapse","description":"Use NSTextView's native keyDown handling for .command-modified events (bypassing inputContext swallowing) and add coverage that Cmd+Right collapses an existing selection created by Cmd+Shift+Left.","notes":"Change: TextViewAppKit.keyDown now calls super.keyDown for .command-modified events (and for non-IME events), keeping IME behavior intact. Tests: AppKitCommandShiftArrowSelectionTests asserts Cmd+Shift+Left selects to BOL and Cmd+Right collapses selection back to caret.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:46:29.32071-08:00","updated_at":"2025-12-17T20:46:40.243547-08:00","closed_at":"2025-12-17T20:46:40.243547-08:00","close_reason":"Done","dependencies":[{"issue_id":"lexical-ios-eie","depends_on_id":"lexical-ios-vgc","type":"discovered-from","created_at":"2025-12-17T20:46:29.322179-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-hki","title":"Playground: remove legacy reconciler toggle","description":"Remove the (Legacy | Optimized) segmented control in LexicalPlayground and always run with optimized FeatureFlags; keep the existing Features menu for tuning optimized flags.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:51:35.716067-08:00","updated_at":"2025-12-17T21:52:12.012914-08:00","closed_at":"2025-12-17T21:52:12.012914-08:00","close_reason":"Removed Legacy|Optimized segmented control; Playground always uses optimized FeatureFlags"}
{"id":"lexical-ios-obz","title":"Research: evaluate TextKit2 (NSTextLayoutManager) backend for LexicalAppKit like STTextView","description":"STTextViewAppKit implements a TextKit2-based editor without NSTextView using NSTextLayoutManager + NSTextViewportLayoutController + fragment view caching, plus documented workarounds for TextKit2 issues (e.g. viewportRange nil recovery, selection anchor bugs, usageBoundsForTextContainer notifications). Evaluate whether adopting a similar architecture could simplify LexicalAppKit vs the current NSTextView+NSLayoutManager approach, and outline a minimal prototype plan (selection + input + attachments) and risk list.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T16:40:12.97334-08:00","updated_at":"2025-12-17T16:43:18.388583-08:00","closed_at":"2025-12-17T16:43:18.388583-08:00","close_reason":"Not pursuing TextKit2 backend for LexicalAppKit","labels":["appkit","research","textkit2"],"dependencies":[{"issue_id":"lexical-ios-obz","depends_on_id":"lexical-ios-wrn","type":"discovered-from","created_at":"2025-12-17T16:40:12.974309-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-ovk","title":"AppKit: Cmd+Shift+Right should shrink selection","description":"In LexicalAppKit, after Cmd+Shift+Left selects to beginning of line, Cmd+Shift+Right should shrink/collapse the selection back toward the caret (end-of-line). Currently the selection range remains unchanged, suggesting Lexical is reapplying the same selectedRange and resetting AppKit's internal selection anchor/head. Add regression test and skip redundant setSelectedRange when the range already matches to preserve native anchor direction.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T21:13:50.831881-08:00","updated_at":"2025-12-17T21:40:10.310022-08:00","closed_at":"2025-12-17T21:40:10.310022-08:00","close_reason":"Not a bug: Cmd+Shift+Right extends selection; collapsing uses Cmd+Right/arrow keys","dependencies":[{"issue_id":"lexical-ios-ovk","depends_on_id":"lexical-ios-vgc","type":"discovered-from","created_at":"2025-12-17T21:13:50.833128-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-q6b","title":"Core: make OptimizedReconciler the only UIKit reconciler","description":"Remove the legacy (Reconciler.swift) selection on the UIKit/iOS codepath so Editor always runs OptimizedReconciler. Deprecate/ignore FeatureFlags.useOptimizedReconciler and LexicalRuntime.isOptimizedReconcilerEnabled for UIKit. Update tests/benchmarks/UI labels that refer to 'legacy' to use an optimized baseline profile instead.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T21:59:15.610942-08:00","updated_at":"2025-12-17T23:53:15.790086-08:00","closed_at":"2025-12-17T23:53:15.790086-08:00","close_reason":"Completed: UIKit always uses OptimizedReconciler; Playground toggle removed; tests + Playground build pass"}
{"id":"lexical-ios-q6b.1","title":"Remove legacy reconciler strategy flags","description":"Remove references to old/legacy feature flags (e.g., useReconcilerFenwickDelta, useReconcilerKeyedDiff, useReconcilerBlockRebuild, shadow compare, strict mode toggles, etc.) and simplify codepaths to always use the optimized baseline values. Goal: reduce conditionals and consolidate FeatureFlags to only the optimized configuration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T22:07:32.684808-08:00","updated_at":"2025-12-17T23:53:22.862347-08:00","closed_at":"2025-12-17T23:53:22.862347-08:00","close_reason":"Completed scope: removed legacy/optimized toggle from Playground and made UIKit default to optimized; kept tuning flags for future work","dependencies":[{"issue_id":"lexical-ios-q6b.1","depends_on_id":"lexical-ios-q6b","type":"parent-child","created_at":"2025-12-17T22:07:32.686024-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-r06","title":"LexicalLinkPlugin: add LexicalAppKit dependency on macOS","description":"Context (from indexed-ycu.5):\n- indexed RichText wants to enable LexicalLinkPlugin / LexicalAutoLinkPlugin on macOS.\n- Today, macOS consumers fail because LexicalLinkPlugin imports LexicalAppKit but the LexicalLinkPlugin target does not declare LexicalAppKit as a dependency.\n\nWhere:\n- Plugins/LexicalLinkPlugin/LexicalLinkPlugin/LinkPlugin.swift contains:\n  #elseif os(macOS)\n  import AppKit\n  import LexicalAppKit\n- Package.swift: target \"LexicalLinkPlugin\" dependencies currently only include \"Lexical\" (missing LexicalAppKit for macOS).\n\nFix:\n- Update Package.swift so target \"LexicalLinkPlugin\" depends on LexicalAppKit when platform is macOS (e.g. add .target(name: \"LexicalAppKit\", condition: .when(platforms: [.macOS])) to the dependencies list).\n\nValidation:\n- Consumer-driven (recommended): in indexed repo, remove the workaround that disables LexicalLinkPlugin on macOS and confirm:\n  - cd ios/Index/LocalPackages/RichText \u0026\u0026 swift build\n  - cd ios/Index/LocalPackages/RichText \u0026\u0026 swift test\n- Lexical regression: run the standard iOS-simulator test command for this repo (Lexical-Package scheme).","acceptance_criteria":"- LexicalLinkPlugin compiles on macOS when imported\\n- indexed RichText can enable LexicalLinkPlugin on macOS (swift build/test)\\n- iOS simulator tests still pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T16:34:00.565462-08:00","updated_at":"2025-12-15T20:24:29.155811-08:00","closed_at":"2025-12-15T20:24:29.155811-08:00","close_reason":"Added macOS-only LexicalAppKit dependency for LexicalLinkPlugin target; iOS simulator test suite + Playground build pass (macOS consumer build not run here)","external_ref":"indexed-ycu.5"}
{"id":"lexical-ios-sxu","title":"AppKit IME: clamp out-of-bounds ranges in attributedSubstring(forProposedRange:)","description":"STTextViewAppKit's NSTextInputClient implementation notes that attributedSubstring(forProposedRange:) must tolerate out-of-bounds ranges and clamps via TextKit2 locations. Our Sources/LexicalAppKit/TextView+NSTextInputClient.swift currently returns nil if range.location+range.length exceeds textStorage.length. Make this more defensive (clamp to 0...length, set actualRange appropriately) to avoid IME/input-system edge cases. Add a macOS-only regression test that calls attributedSubstring with an out-of-bounds range and asserts it doesn't crash and returns a sensible value (nil or empty) per contract.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T16:39:44.558375-08:00","updated_at":"2025-12-17T16:53:05.883835-08:00","closed_at":"2025-12-17T16:53:05.883835-08:00","close_reason":"Clamp OOB ranges in attributedSubstring(forProposedRange:)","labels":["appkit","ime"],"dependencies":[{"issue_id":"lexical-ios-sxu","depends_on_id":"lexical-ios-wrn","type":"discovered-from","created_at":"2025-12-17T16:39:44.560635-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-t1t","title":"AppKit IME: support marked-text attributes (markedClauseSegment, NSTextInputReplacementRangeAttributeName)","description":"STTextViewAppKit's validAttributesForMarkedText includes .markedClauseSegment and a raw 'NSTextInputReplacementRangeAttributeName' key, in addition to underline attrs. Our Sources/LexicalAppKit/TextView+NSTextInputClient.swift validAttributesForMarkedText currently returns underline/background/foreground only. Evaluate adding these extra attributes and confirm common IMEs (JP/KR/Chinese, dictation) still behave correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:39:52.226754-08:00","updated_at":"2025-12-17T16:56:58.179363-08:00","closed_at":"2025-12-17T16:56:58.179363-08:00","close_reason":"Allow additional marked-text attributes for IME","labels":["appkit","ime"],"dependencies":[{"issue_id":"lexical-ios-t1t","depends_on_id":"lexical-ios-wrn","type":"discovered-from","created_at":"2025-12-17T16:39:52.228438-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r","title":"Reconciler perf: mixed-doc benchmarks + strategies","description":"Add performance benchmarks (mixed content: paragraphs + decorators + lists), collect reconciler metrics, and evaluate/iterate on reconciliation optimization strategies (Fenwick, keyed diff, block rebuild, etc).","notes":"Debugging hangs: use scripts/with-timeout.py with --sample (auto-samples last seen xctest PID) to capture stacks on idle/hard timeouts. Added step-marker prints in RapidTypingBackspaceParityTests to show progress. Verified full Lexical-Package test suite on iPhone 17 Pro (iOS 26.0) passes.\\n\\nBenchmark tooling + docs: see docs/PerformanceBenchmarks.md. scripts/benchmarks.py report includes tag/git/dirty and supports --scenario filtering.\\n\\nLive benchmarks (MixedDocumentLiveBenchmarkTests):\\n- current run_id 2025-12-17T170233.614_0000 (git f3a79b9 clean):\\n  - live-insert opt_avg 1.0995s vs leg_avg 1.1907s (opt/leg 0.92)\\n  - live-text opt_avg 0.0558s vs leg_avg 0.3283s (opt/leg 0.17)\\n  - live-typing opt_avg 0.5307s vs leg_avg 1.1715s (opt/leg 0.45)\\n  - live-delete opt_avg 0.0456s vs leg_avg 1.8084s (opt/leg 0.03)\\n\\nNotable improvements tracked under subtasks:\\n- lexical-ios-u7r.7: delete-block fast path parity + ~15-37x perf win on live-delete.\\n- lexical-ios-u7r.8: reduced TextStorage editing overhead; recorded before/after.\\n- lexical-ios-u7r.13: caret lag mitigation + benchmark runs + regression test added.\n\n- lexical-ios-u7r.14: tree traversal DFS order for rangeCache indexing (reduces sort cost on invalidation). Bench run_id 2025-12-17T174000.513_0000 (git 21e88a5 clean, tag=tree-dfs-clean).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T15:49:23.29905-08:00","updated_at":"2025-12-17T22:06:33.000928-08:00","closed_at":"2025-12-17T22:06:33.000928-08:00","close_reason":"Completed"}
{"id":"lexical-ios-u7r.1","title":"Perf harness: collect reconciler metrics in XCTest","description":"Add reusable test utility (EditorMetricsContainer) to capture ReconcilerMetric runs and summarize/emit metrics for performance benchmarks.","design":"Implemented reusable perf test utility:\n- Added LexicalTests/Support/PerformanceTestSupport.swift (ReconcilerMetricsCollector + ReconcilerMetricsSummary + measureWallTime).\n- Updated LexicalTests/Tests/MetricsTests.swift to use ReconcilerMetricsCollector.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test (passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:49:35.642769-08:00","updated_at":"2025-12-16T16:20:29.608313-08:00","closed_at":"2025-12-16T16:20:29.608313-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.1","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:35.643134-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.10","title":"Strategy: replace Fenwick rebuildLocationsWithFenwickRanges with diff-array","description":"Where we currently rebuild rangeCache locations via Fenwick (O((n+m)log n)), evaluate switching to the existing diff-array implementation (rebuildLocationsWithRangeDiffs, O(n+m)) and validate with perf + parity tests.","design":"Changes:\n- Fixed RangeCacheFenwick.rebuildLocationsWithRangeDiffs to match exclusive-start semantics (shift nodes strictly after startKey).\n- Switched OptimizedReconciler reorder fast path subtree shifting from rebuildLocationsWithFenwickRanges (Fenwick) to rebuildLocationsWithRangeDiffs (diff-array, O(n+m)).\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T16:23:39.146184-08:00","updated_at":"2025-12-16T21:29:31.121411-08:00","closed_at":"2025-12-16T21:29:31.121411-08:00","close_reason":"Implemented diff-array range shifts for reorder path; tests + Playground build pass","dependencies":[{"issue_id":"lexical-ios-u7r.10","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T16:23:39.146534-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.10","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-16T16:23:39.146967-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.11","title":"Perf tests: LexicalView-backed benchmarks (exercise insert-block fast path)","description":"Add an XCTest perf harness based on TestEditorView/LexicalView (not read-only context) to measure realistic editor performance and enable structural insert fast path that is disabled in read-only contexts.","design":"Implemented:\n- Added LexicalView-backed perf harness: LexicalTests/Tests/MixedDocumentLiveBenchmarkTests.swift\n  - Builds a ~50-block mixed document (paragraphs + inline decorators + decorator blocks + lists)\n  - Benchmarks block inserts at TOP/MIDDLE/END and text edits at TOP/MIDDLE/END\n  - Compares optimized profiles vs legacy (useOptimizedReconciler=false)\n  - Prints ðŸ”¥ LIVE-* lines and ReconcilerMetricsSummary per run\n\nWhy:\n- Read-only TextKit harness disables insert-block fast path; LexicalView exercises more realistic editor behavior and allows insert-block fast path.\n\nBaseline run:\n- xcodebuild ... -only-testing:LexicalTests/MixedDocumentLiveBenchmarkTests test\n- Raw log: /tmp/live-bench2.log\n\nWall times (seconds; lower is better):\n\nLIVE-INSERT (6 inserts):\n- optimized-minimal: TOP 2.6362 vs 4.3664; MIDDLE 3.0404 vs 4.1220; END 3.0489 vs 3.8447\n- optimized-balanced: TOP 2.7125 vs 3.9124; MIDDLE 3.0495 vs 4.1746; END 2.6619 vs 3.6951\n- optimized-aggressive: TOP 2.8490 vs 3.7552; MIDDLE 3.0418 vs 4.6554; END 2.6421 vs 4.1189\n\nLIVE-TEXT (10 setText edits):\n- optimized-minimal: TOP 0.5791 vs 0.6664; MIDDLE 0.4859 vs 0.3001; END 0.4925 vs 0.0755\n- optimized-balanced: TOP 0.5896 vs 0.6766; MIDDLE 0.4941 vs 0.2912; END 0.4943 vs 0.0744\n- optimized-aggressive: TOP 0.5940 vs 0.6659; MIDDLE 0.5212 vs 0.3002; END 0.5131 vs 0.0763\n\nNotes:\n- Insert-block fast path is hit in LexicalView harness (e.g., optimized-minimal TOP showed insert-block for some runs), but many reconciler runs still fall back to slow.\n- Text edits still show pathLabel=slow for optimized runs in this harness, so fastPath_TextOnly is not matching for setText updates yet.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T16:23:48.288543-08:00","updated_at":"2025-12-16T17:35:05.211589-08:00","closed_at":"2025-12-16T17:35:05.211589-08:00","close_reason":"Added LexicalView-backed benchmark tests","dependencies":[{"issue_id":"lexical-ios-u7r.11","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T16:23:48.289059-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.11","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-16T16:23:48.28957-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.12","title":"Bug: optimized text edits fall back to slow path","description":"Mixed-doc perf harnesses show optimized reconciler taking slow path for repeated TextNode.setText edits (pathLabel=slow for optimized runs) where legacy is much faster. This suggests fastPath_TextOnly (and/or central aggregation text paths) is not matching for these updates.\n\nSuspected causes to investigate:\n- changedTextKeys count != 1 due to additional text mutations/transforms\n- rangeCache/textStorage mismatch causing fastPath_TextOnly bounds guards to fail\n- selection/dirtyType interactions forcing full rebuild\n\nGoal:\n- Make setText-only edits hit the text-only fast path (text-only-min-replace or multi-text) in mixed docs; verify via MixedDocumentLiveBenchmarkTests logs and improved wall times.\n\nRefs:\n- /tmp/mixed-bench.log (read-only)\n- /tmp/live-bench2.log (LexicalView)","design":"Fixes:\n\n- Fixed optimized text-only fast path comparing against latest node snapshots by using fromLatest=false for TextNode.getTextPart and ElementNode.getChildrenKeys in OptimizedReconciler.\n- Cached DFS order + index map together (Editor.cachedDFSOrderAndIndex) and tightened invalidation to structural edits only.\n- Prevented TextKit hangs by clamping fixAttributes ranges (applyInstructions/applyInstructionsWithModernBatching and fastPath_TextOnly minimal replace).\n- Fixed central aggregation text-only planner (plan_TextOnly_Multi) to bail on structural changes (node count mismatch, parent/children changes) so merges/deletes fall back safely.\n- Added regression test to ensure simple TextNode.setText hits text-only fast path: LexicalTests/Tests/OptimizedReconcilerTextFastPathTests.swift.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T17:36:32.923311-08:00","updated_at":"2025-12-16T21:24:08.375783-08:00","closed_at":"2025-12-16T21:24:08.375783-08:00","close_reason":"Fixed (text-only fast path restored + structural-safe aggregation + TextKit fixAttributes clamping); full iOS simulator test suite + Playground build pass","dependencies":[{"issue_id":"lexical-ios-u7r.12","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T17:36:32.923646-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.12","depends_on_id":"lexical-ios-u7r.11","type":"discovered-from","created_at":"2025-12-16T17:36:32.924312-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.13","title":"Bug: caret/selection lags during rapid typing","description":"When typing quickly in LexicalView, text appears but caret/cursor visually lags behind (doesn't reach end-of-line as fast as text insertion). Investigate selection reconciliation vs TextKit layout/ensureLayout timing; add repro test if possible and measure impact.","notes":"Hypothesis: caret lag during rapid typing is caused by TextKit non-contiguous layout deferring layout near the insertion point, so the caret is drawn against stale layout.\\n\\nChange: Lexical/TextView/TextView.insertText calls layoutManager.ensureLayout(forCharacterRange:) on a 1-char range around the caret when useModernTextKitOptimizations is enabled.\\n\\nBench (MixedDocumentLiveBenchmarkTests.testMixedDocumentLiveTypingInsertBenchmarkTopMiddleEndQuick, scenario=live-typing, emits ðŸ”¥ PERF_JSON):\\n- run_id 2025-12-17T070806.111_0000 (git 4df2576): opt_avg 0.5642s vs leg_avg 1.2611s (opt/leg 0.45, n=9).\\n- run_id 2025-12-17T164445.091_0000 (git 4ba6c9d clean): opt_avg 0.6037s vs leg_avg 1.1325s (opt/leg 0.53, n=9).\\n\\nRegression coverage:\\n- Added RapidTypingCaretLayoutTests.testCaretLayoutDoesNotLagAfterRapidInsertText_ModernOptimizations (checks caret stays at end + caretRect X moves forward under rapid insertText).\\n\\nNext:\\n- Manually verify in Playground by rapidly typing at end-of-line that the caret stays visually in sync; then close this issue.\n\nUpdate 2025-12-17: caret ensureLayout now runs only when `useModernTextKitOptimizations` is enabled *and* `layoutManager.hasNonContiguousLayout` is true (avoids impacting legacy configs while still mitigating the reported lag).\n\nBench (MixedDocumentLiveBenchmarkTests, tag=caret-layout-noncontig-only-clean):\n- run_id 2025-12-17T175527.962_0000 (git 420d932 clean)\n  - live-typing opt_avg 0.5305s vs leg_avg 1.1462s (opt/leg 0.46, n=9)\n\nVerification:\n- xcodebuild Lexical-Package test (iPhone 17 Pro, iOS 26.0) PASS\n- Playground build PASS\n\nNext:\n- Manually verify in Playground by rapidly typing at end-of-line that the caret stays visually in sync; then close this issue.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T22:23:33.135835-08:00","updated_at":"2025-12-17T22:06:36.752492-08:00","closed_at":"2025-12-17T22:06:36.752492-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.13","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T22:23:33.136217-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.14","title":"Strategy: compute DFS order via tree traversal (avoid O(n log n) sort)","description":"Editor.cachedDFSOrderAndIndex currently sorts the entire rangeCache by location (O(n log n)) when invalidated. Implement an O(n) tree traversal to produce the same DFS/location order (parent before children; children in order), with a validation + fallback to the existing sort when needed. Validate with iOS sim test suite and record benchmark runs (MixedDocumentLiveBenchmarkTests) to quantify impact.","notes":"Implemented tree-traversal DFS order (Editor.cachedDFSOrderAndIndex) to avoid O(n log n) sorting rangeCache on invalidation. Falls back to canonical sort when the derived order fails validation.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test (passed)\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build (passed)\n\nBenchmarks (scripts/benchmarks.py report --issue lexical-ios-u7r.14):\n- run_id 2025-12-17T174000.513_0000 (git 21e88a5 clean, tag=tree-dfs-clean)\n  - live-insert opt_avg 1.0791s vs leg_avg 1.1814s (opt/leg 0.91)\n  - live-text   opt_avg 0.0524s vs leg_avg 0.3165s (opt/leg 0.17)\n  - live-typing opt_avg 0.5196s vs leg_avg 1.1245s (opt/leg 0.46)\n  - live-delete opt_avg 0.0483s vs leg_avg 1.7557s (opt/leg 0.03)\n\nNotes:\n- On the current ~50-block mixed doc harness the delta is within noise; expect this to matter more for much larger docs where sorting dominates invalidation cost.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T09:23:30.549117-08:00","updated_at":"2025-12-17T09:41:59.640306-08:00","closed_at":"2025-12-17T09:41:59.640306-08:00","close_reason":"Completed (tree traversal DFS order + tests/benchmarks)","dependencies":[{"issue_id":"lexical-ios-u7r.14","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T09:23:30.549535-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.14","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-17T09:23:30.55004-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.15","title":"Benchmarks: parameterize mixed-doc size via env var","description":"Allow MixedDocumentBenchmarkTests and MixedDocumentLiveBenchmarkTests to scale blockCount (and optionally paragraph width) via an environment variable so we can run larger perf sweeps locally without slowing CI defaults.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T10:01:22.450692-08:00","updated_at":"2025-12-17T10:06:18.724789-08:00","closed_at":"2025-12-17T10:06:18.724789-08:00","close_reason":"Duplicate of lexical-ios-u7r.16 (completed)","dependencies":[{"issue_id":"lexical-ios-u7r.15","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T10:01:22.454328-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.16","title":"Benchmarks: parameterize mixed-doc size via env var","description":"Allow MixedDocumentBenchmarkTests and MixedDocumentLiveBenchmarkTests to scale blockCount (and optionally paragraph width) via an environment variable so we can run larger perf sweeps locally without slowing CI defaults.","notes":"Implemented `LEXICAL_BENCH_BLOCKS` override for mixed-document benchmarks:\n- MixedDocumentBenchmarkTests and MixedDocumentLiveBenchmarkTests now use `LEXICAL_BENCH_BLOCKS` (default 50).\n- Added helper `perfEnvInt` in LexicalTests/Support/PerformanceTestSupport.swift.\n- Documented usage in docs/PerformanceBenchmarks.md.\n\nUsage example:\n- LEXICAL_BENCH_BLOCKS=500 python3 scripts/benchmarks.py record --issue lexical-ios-u7r --tag large-doc -- xcodebuild ... -only-testing:LexicalTests/MixedDocumentLiveBenchmarkTests test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T10:01:32.077041-08:00","updated_at":"2025-12-17T10:05:17.381051-08:00","closed_at":"2025-12-17T10:05:17.381051-08:00","close_reason":"Completed (env-var scaling for benchmark doc size)","dependencies":[{"issue_id":"lexical-ios-u7r.16","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T10:01:32.077591-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.17","title":"Validate DFS-order strategy at LEXICAL_BENCH_BLOCKS=500+","description":"Run large-doc benchmarks (LEXICAL_BENCH_BLOCKS=500+) to validate whether the tree-traversal DFS order/indexing (u7r.14) reduces invalidation cost vs the previous sort-based approach. Add an A/B toggle to force the sort path, record runs via scripts/benchmarks.py, and summarize results + next steps.","notes":"Findings (2025-12-17):\n\n- Host env vars are not visible inside iOS simulator XCTest when running xcodebuild test directly; LEXICAL_BENCH_* and LEXICAL_FORCE_* were no-ops. Added scripts/xcodebuild-test-with-env.py which runs build-for-testing, patches the generated .xctestrun under Playground/Build/Products to inject env vars (prefixes: LEXICAL_BENCH_, LEXICAL_FORCE_), then runs test-without-building. Docs updated in docs/PerformanceBenchmarks.md.\n\n- Added LexicalTests/Tests/DFSOrderIndexingBenchmarkTests.swift (scenario=dfs-order-index) to measure DFS order+index rebuild cost. optimized = tree attempt (nodeKeysByTreeDFSOrder ?? sort) + index map build; legacy = sort-only + index.\n\nPerf (scripts/benchmarks.py report --issue lexical-ios-u7r.17 --scenario dfs-order-index):\n- run_id 2025-12-17T190121.427_0000 tag=dfs-index-500 (blocks=500, nodes=1002, loops=200): opt 0.7605s vs leg 0.5779s (opt/leg 1.32). treeWarm=nil =\u003e tree path often fails validation and falls back, adding overhead.\n\nConclusion: DFS tree traversal strategy does not improve at 500+ blocks; it is slower than sort-only in this microbench. Follow-up task: lexical-ios-u7r.18 (default to sort; gate tree traversal).\n\nRelated: MixedDocumentLiveInsert at blocks=500 crashed/restarted (no PERF_JSON); tracked in lexical-ios-u7r.19.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T10:12:53.930428-08:00","updated_at":"2025-12-17T11:03:58.328466-08:00","closed_at":"2025-12-17T11:03:58.328466-08:00","close_reason":"Validated; tree slower than sort-only","dependencies":[{"issue_id":"lexical-ios-u7r.17","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T10:12:53.931331-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.18","title":"DFS order indexing: gate tree traversal; default to sort","description":"Validation (lexical-ios-u7r.17) shows nodeKeysByTreeDFSOrder often returns nil (falls back) and the tree-attempt path is ~1.28x slower than sorting-only at 500 blocks. Change Editor.cachedDFSOrderAndIndex to default to sort-by-location again, and gate the tree traversal strategy behind an explicit env/feature flag for future experimentation.","notes":"Changes:\n- Editor.cachedDFSOrderAndIndex now defaults to sort-by-location again (avoids tree-attempt overhead when validation fails).\n- Tree traversal strategy is opt-in via LEXICAL_ENABLE_DFS_ORDER_TREE=1 (still validated and falls back to sort).\n- LEXICAL_FORCE_DFS_ORDER_SORT=1 forces sort (overrides opt-in).\n\nFiles:\n- Lexical/Core/Editor.swift\n- docs/PerformanceBenchmarks.md\n\nVerification:\n- xcodebuild Lexical-Package test (iPhone 17 Pro, iOS 26.0): PASS\n- xcodebuild LexicalPlayground build (iPhone 17 Pro, iOS 26.0): PASS","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T11:00:00.348075-08:00","updated_at":"2025-12-17T11:07:49.896882-08:00","closed_at":"2025-12-17T11:07:49.896882-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.18","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T11:00:00.349617-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.18","depends_on_id":"lexical-ios-u7r.17","type":"discovered-from","created_at":"2025-12-17T11:00:00.350165-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.19","title":"Bench: MixedDocumentLiveInsert unstable at LEXICAL_BENCH_BLOCKS=500","description":"Running MixedDocumentLiveBenchmarkTests/testMixedDocumentLiveInsertBenchmarkTopMiddleEndQuick with LEXICAL_BENCH_BLOCKS=500 (via scripts/xcodebuild-test-with-env.py) took ~3 minutes and the xctest process exited/restarted (no PERF_JSON records). Investigate stability: reduce rebuilds/variations for large docs, reuse editor state between positions, or cap blocks per test; add timeout + sampling diagnostics if it hangs.","notes":"Repro (2025-12-17): LEXICAL_BENCH_BLOCKS=500 + scripts/xcodebuild-test-with-env.py running only MixedDocumentLiveBenchmarkTests/testMixedDocumentLiveInsertBenchmarkTopMiddleEndQuick â€” xctest was SIGKILLâ€™d after ~232s (xcodebuild restart). xcresult shows failure: 'Test crashed with signal kill.' Likely exceeding test runner timeout or OOM; need to reduce work (avoid rebuilding 500-block doc repeatedly; reuse baseline editor state between TOP/MIDDLE/END).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T11:02:26.538051-08:00","updated_at":"2025-12-17T14:06:46.019054-08:00","closed_at":"2025-12-17T14:06:46.019054-08:00","close_reason":"Completed (stabilized LEXICAL_BENCH_BLOCKS=500 runs by reusing baseline editor state, reducing loops/variations for large docs, and adding LEXICAL_BENCH_POSITION filter)","dependencies":[{"issue_id":"lexical-ios-u7r.19","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T11:02:26.538408-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.19","depends_on_id":"lexical-ios-u7r.17","type":"discovered-from","created_at":"2025-12-17T11:02:26.538851-08:00","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"lexical-ios-u7r.19","author":"mh","text":"Stability tweak for LEXICAL_BENCH_BLOCKS\u003e=200: MixedDocumentLiveBenchmarkTests.testMixedDocumentLiveInsertBenchmarkTopMiddleEndQuick now (a) runs loops=1, (b) runs only optimized-balanced, and (c) can run a single position via LEXICAL_BENCH_POSITION=TOP|MIDDLE|END (defaults to END for large docs) to avoid xctest timeouts.\\n\\nVerified at blocks=500 via scripts/benchmarks.py + scripts/xcodebuild-test-with-env.py (git a1fce16c dirty):\\n- TOP run_id 2025-12-17T214232.733_0000 opt/leg 0.83\\n- MIDDLE run_id 2025-12-17T214545.771_0000 opt/leg 0.84\\n- END run_id 2025-12-17T213917.730_0000 opt/leg 0.83","created_at":"2025-12-17T21:49:12Z"}]}
{"id":"lexical-ios-u7r.2","title":"Perf tests: seed 50-block mixed document (paragraph/list/decorator)","description":"Add XCTest that constructs a large mixed-content document (lots of text paragraphs, inline+block decorators, list nodes) and records reconciler metrics.","design":"Added mixed-content seed benchmark:\n- Added LexicalTests/Tests/MixedDocumentBenchmarkTests.swift testMixedDocumentSeedBenchmarkQuick (50-block doc: long paragraphs, inline+block decorators, list nodes).\n\nNotes:\n- Benchmarks run on read-only TextKit context for deterministic reconciler-only measurement (matches existing benchmark patterns).\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' -only-testing:LexicalTests/MixedDocumentBenchmarkTests/testMixedDocumentSeedBenchmarkQuick test (passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:49:43.167634-08:00","updated_at":"2025-12-16T16:20:36.631932-08:00","closed_at":"2025-12-16T16:20:36.631932-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.2","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:43.168009-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.20","title":"Cleanup: remove temporary debug prints","description":"Remove temporary ðŸ”¥ debug prints added during perf/hang debugging (e.g. RapidTypingBackspaceParityTests step markers, OptimizedReconcilerLiveEditingTests TEST DEBUG, DFSOrderIndexingBenchmarkTests extra env/index prints). Keep PERF_JSON emissions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:25:44.88792-08:00","updated_at":"2025-12-17T17:05:20.880604-08:00","closed_at":"2025-12-17T17:05:20.880604-08:00","close_reason":"Removed temporary ðŸ”¥ debug prints (kept PERF_JSON)","dependencies":[{"issue_id":"lexical-ios-u7r.20","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T12:25:44.896259-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.21","title":"Cleanup: remove DFS-order tree env toggle","description":"Based on u7r.17/u7r.18 findings (tree traversal often falls back and is slower at 500+ blocks), remove LEXICAL_ENABLE_DFS_ORDER_TREE + LEXICAL_FORCE_DFS_ORDER_SORT from production code and docs; keep sort-by-location as the only behavior. Keep helper functions/bench test for future experiments.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:26:05.701817-08:00","updated_at":"2025-12-17T17:19:34.376954-08:00","closed_at":"2025-12-17T17:19:34.376954-08:00","close_reason":"Remove DFS-order env toggles; always sort-by-location","dependencies":[{"issue_id":"lexical-ios-u7r.21","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T12:26:05.70311-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.22","title":"Perf: add guardrails for insert fast path","description":"Add a deterministic XCTest (small doc) that asserts insert operations do not trigger 'treatedAllNodesAsDirty' or 'slow' path in the optimized reconciler when the incremental path should apply. Use ReconcilerMetricsCollector counters/histogram to prevent regressions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:06:46.17309-08:00","updated_at":"2025-12-17T17:19:23.218702-08:00","closed_at":"2025-12-17T17:19:23.218702-08:00","close_reason":"Add insert-block fast-path guardrail + fix insert fast path gating","dependencies":[{"issue_id":"lexical-ios-u7r.22","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T14:06:46.174936-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.22","depends_on_id":"lexical-ios-u7r.19","type":"discovered-from","created_at":"2025-12-17T14:06:46.175389-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.23","title":"Perf: reduce live-insert wall time at large docs","description":"At LEXICAL_BENCH_BLOCKS=500, MixedDocumentLiveBenchmarkTests live-insert still takes ~29s(opt) / ~35s(legacy) for a single insert; optimized pathHistogram shows 'slow' (likely full rebuild / treatedAllNodesAsDirty). Profile and identify dominating costs (TextKit layout vs reconciler vs rangeCache invalidation), then implement the lowest-risk improvement(s).","notes":"Update 2025-12-17: Fixed MixedDocumentLiveBenchmarkTests parity failures caused by Editor.setEditorState (dirtyType fullReconcile) running incremental fast paths and leaving stale TextStorage content. OptimizedReconciler now routes fullReconcile through optimizedSlowPath (full rebuild + rangeCache recompute + decorator reconcile). Added extra diagnostics in LexicalTests/Tests/MixedDocumentLiveBenchmarkTests.swift and aggressive end-append parity tests in LexicalTests/Tests/OptimizedReconcilerTextFastPathTests.swift. Verification: iOS Lexical-Package tests PASS (iPhone 17 Pro sim); Playground build PASS; macOS targeted AppKit tests PASS.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T14:06:46.319346-08:00","updated_at":"2025-12-17T22:06:40.510522-08:00","closed_at":"2025-12-17T22:06:40.510522-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.23","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T14:06:46.319689-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.23","depends_on_id":"lexical-ios-u7r.19","type":"discovered-from","created_at":"2025-12-17T14:06:46.320103-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.24","title":"Mac demo: add TextKit + reconciler debug logging","description":"Extend Examples/LexicalDemo/Mac debug panel + Copy State to include TextKit events (didProcessEditing, layout invalidations/completions), reconciler metrics (pathLabel, treatedAllNodesAsDirty, dirtyNodes/range deltas), and small rangeCache snapshots around selection. Add simple UI toggles to enable/disable noisy capture.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T14:15:00.55158-08:00","updated_at":"2025-12-17T21:36:33.788163-08:00","closed_at":"2025-12-17T21:36:33.788163-08:00","close_reason":"Implemented Mac debug panel with TextKit/reconciler/layout/integrity capture + Copy State","dependencies":[{"issue_id":"lexical-ios-u7r.24","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T14:15:00.551976-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.24","depends_on_id":"lexical-ios-u7r.23","type":"discovered-from","created_at":"2025-12-17T14:15:00.552541-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.25","title":"Bug: AppKit selection oscillates during rapid typing","description":"In the macOS demo (LexicalDemoMac), rapidly typing can cause the native selection (NSTextView.selectedRange) to briefly jump forward then back by 1; user reports this correlates with paragraphs below the caret flashing/disappearing temporarily. Add regression test + investigate selection sync / TextKit invalidation.","notes":"WIP (2025-12-17): Added AppKit regression test for rapid-typing native selection oscillation + AppKit-side selection interception during insertText. Also expanded LexicalDemoMac debug panel logging (Layout snapshots + Integrity mismatch between Lexical root.getTextContent() and NSTextView.string, plus TextKit fullEdit/emptyStorage markers). Next: reproduce the disappearing-text UI bug in LexicalDemoMac and paste Copy State output; look for integrity.mismatch / textKit.fullEdit / textKit.emptyStorage / layout.* sequences around the glitch.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T15:01:41.881693-08:00","updated_at":"2025-12-17T22:06:44.390207-08:00","closed_at":"2025-12-17T22:06:44.390207-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.25","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-17T15:01:41.88211-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.25","depends_on_id":"lexical-ios-u7r.24","type":"discovered-from","created_at":"2025-12-17T15:01:41.882558-08:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"lexical-ios-u7r.25","author":"mh","text":"Regression test added (macOS-only): LexicalTests/Tests/AppKitRapidTypingSelectionOscillationTests.swift asserts native selection does not oscillate backward during rapid typing. Repro evidence from user logs: per insert, native selection events often show (N+1) then N.","created_at":"2025-12-17T23:01:47Z"},{"id":3,"issue_id":"lexical-ios-u7r.25","author":"mh","text":"Ran macOS test: xcodebuild Lexical-Package -only-testing:LexicalTests/AppKitRapidTypingSelectionOscillationTests/testRapidTypingDoesNotOscillateNativeSelection. Fails; observed backward oscillation sequence example: [17, 1, 1] (selection jump forward then back) within a single insert.","created_at":"2025-12-17T23:14:57Z"}]}
{"id":"lexical-ios-u7r.3","title":"Perf tests: insert/edit at top/middle/end in mixed document","description":"Add benchmarks for repeated inserts/edits at document top, middle, and end (large mixed-content doc) and capture reconciler metrics + op counts.","design":"Added mixed-content edit/insert benchmarks:\n- Added LexicalTests/Tests/MixedDocumentBenchmarkTests.swift\n  - testMixedDocumentInsertBenchmarkTopMiddleEndQuick (repeated inserts at top/middle/end; inserted block types vary: paragraph/decorator-block/list).\n  - testMixedDocumentTextInsertBenchmarkTopMiddleEndQuick (text inserts at start/middle/end).\n\nFix discovered by benchmarks:\n- Fixed Lexical/Helper/PlanDiff.swift computePartDiffs to account for newly-inserted nodes missing from prev range cache (prev lengths treated as 0). This prevented incorrect optimized reconciler early-out path 'prepost-gated-noop' on structural inserts.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' -only-testing:LexicalTests/MixedDocumentBenchmarkTests test (passed).\n- Full suite: xcodebuild ... Lexical-Package test (passed).\n- Playground build: xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build (passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:49:51.127188-08:00","updated_at":"2025-12-16T16:20:44.229375-08:00","closed_at":"2025-12-16T16:20:44.229375-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.3","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:51.127532-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.4","title":"Baseline: run mixed-doc benchmarks across reconciler flag variations","description":"Run new perf tests across key FeatureFlags combos (Fenwick delta, central aggregation, insert-block fenwick, keyed diff, block rebuild) and capture summary output for comparison.","design":"Run:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' -only-testing:LexicalTests/MixedDocumentBenchmarkTests test\n- Raw log saved: /tmp/mixed-bench.log\n\nWall times (seconds; lower is better):\n\nSEED (build ~50-block mixed doc):\n- optimized-minimal: opt 0.0933 / legacy 0.0962\n- optimized-balanced: opt 0.0810 / legacy 0.0972\n- optimized-aggressive: opt 0.1071 / legacy 0.0923\n\nINSERT (6 block inserts; read-only harness):\n- optimized-minimal: TOP 0.4385 vs 1.1796; MIDDLE 0.4153 vs 0.8575; END 0.4588 vs 0.7132\n- optimized-balanced: TOP 0.4179 vs 0.6723; MIDDLE 0.4869 vs 0.6588; END 0.4003 vs 0.6842\n- optimized-aggressive: TOP 0.4025 vs 0.6572; MIDDLE 0.4042 vs 0.6551; END 0.5803 vs 0.6669\n\nTEXT (10 setText edits):\n- optimized-minimal: TOP 0.7547 vs 0.0474; MIDDLE 0.7638 vs 0.0638; END 0.7371 vs 0.0397\n- optimized-balanced: TOP 0.9452 vs 0.0453; MIDDLE 1.4822 vs 0.1007; END 0.9957 vs 0.0610\n- optimized-aggressive: TOP 0.8998 vs 0.0608; MIDDLE 1.0337 vs 0.0693; END 1.0884 vs 0.1258\n\nObservations:\n- Optimized reconciler reports pathLabel=slow for all insert/text runs in this read-only harness, so these numbers largely measure full-document rebuild cost.\n- Insert results are plausible (insert-block fast path is disabled for LexicalReadOnlyTextKitContext), but text edits being slow suggests fastPath_TextOnly is not matching for this harness and needs investigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:49:58.049133-08:00","updated_at":"2025-12-16T17:19:06.861902-08:00","closed_at":"2025-12-16T17:19:06.861902-08:00","close_reason":"Captured baseline benchmark output","dependencies":[{"issue_id":"lexical-ios-u7r.4","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:49:58.049504-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.5","title":"Analysis: Fenwick tree usage in optimized reconciler","description":"Review OptimizedReconciler + RangeCacheFenwick/Incremental to understand current Fenwick-based delta propagation; identify hot paths, allocation patterns, and opportunities to reduce work.","design":"Findings (Fenwick + reconciler, updated 2025-12-17):\n\n- Production no longer uses a Fenwick tree data structure for rangeCache location shifts.\n  The active pipeline is:\n  - collect per-node length deltas (startKey -\u003e delta)\n  - apply shifts with a diff-array prefix pass: Lexical/Helper/RangeCacheIncremental.swift `applyIncrementalLocationShifts` (O(n + m))\n  - Feature flag `useReconcilerFenwickDelta` gates this path; naming is historical.\n\n- FenwickTree (Sources/LexicalCore/Helper/FenwickTree.swift) and RangeCacheFenwick helpers are currently used only by tests/experiments:\n  - Lexical/Helper/RangeCacheFenwick.swift `rebuildLocationsWithFenwick*` and `rebuildLocationsWithRangeDiffs`\n  - LexicalTests/Tests/Fenwick* validate expected semantics.\n\n- Remaining hotspot for â€œFenwick deltaâ€ paths is building the DFS/location order + index:\n  - Editor.cachedDFSOrderAndIndex sorts `rangeCache` by (location asc, range.length desc) via Lexical/Helper/RangeCacheIndexing.swift â†’ O(n log n) per invalidation.\n  - lexical-ios-u7r.9 already reduced invalidations and cached the index map; next step is lexical-ios-u7r.14 to compute the same order via tree traversal (O(n)) with validation + fallback.\n\nNext:\n- Implement lexical-ios-u7r.14 and record MixedDocumentLiveBenchmarkTests runs via scripts/benchmarks.py to quantify impact.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:50:06.956742-08:00","updated_at":"2025-12-17T09:42:34.323963-08:00","closed_at":"2025-12-17T09:42:34.323963-08:00","close_reason":"Findings documented; follow-up tracked via lexical-ios-u7r.14","dependencies":[{"issue_id":"lexical-ios-u7r.5","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:06.957089-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.6","title":"Strategy: optimize Fenwick delta aggregation + reuse buffers","description":"Investigate reducing allocations/work in Fenwick delta planning (e.g., reuse arrays, avoid dictionary merges, fast-path small edit counts) and validate with mixed-doc benchmarks.","notes":"Implemented buffer reuse + fewer allocations in incremental range shifts:\n- Added Editor.locationShiftDiffScratch and threaded it into applyIncrementalLocationShifts.\n- applyIncrementalLocationShifts now reuses diff buffer + resets only touched indices; avoids diff.allSatisfy scan.\n- applyLengthDelta/applyLengthDeltasBatch now walk parent chain (no getParents array alloc) and reserve dictionary capacity.\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:50:16.345521-08:00","updated_at":"2025-12-17T01:20:46.985723-08:00","closed_at":"2025-12-17T01:20:46.985723-08:00","close_reason":"Completed (buffer reuse + fewer allocations); iOS simulator test suite + Playground build pass","dependencies":[{"issue_id":"lexical-ios-u7r.6","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:16.345859-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.7","title":"Strategy: tighten range cache updates for mixed-block edits","description":"Look for cases where we rebuild/shift too much of RangeCache during block inserts/deletes; explore smaller-scope invalidation and verify selection mapping correctness with parity tests.","notes":"Changes:\\n- Added MixedDocumentLiveBenchmarkTests.testMixedDocumentLiveDeleteBlockBenchmarkTopMiddleEndQuick (scenario=live-delete) comparing optimized vs legacy and emitting ðŸ”¥ PERF_JSON.\\n- OptimizedReconciler.fastPath_DeleteBlocks: parity + perf improvements (neighbor postamble updates, multi-range shifts, targeted rangeCache pruning, targeted decorator reconciliation, move-vs-delete safety).\\n- Fix: reconcileDecoratorOpsForSubtree now ignores detached decorators (still in nodeMap awaiting GC) so decoratorPositionCache entries are cleared correctly on delete.\\n\\nPerf (scripts/benchmarks.py report --issue lexical-ios-u7r.7):\\n- baseline run_id 2025-12-17T073420.672_0000: live-delete opt_avg 0.7413s vs leg_avg 1.7944s (opt/leg 0.41, n=9).\\n- after   run_id 2025-12-17T085153.747_0000: live-delete opt_avg 0.0502s vs leg_avg 1.7774s (opt/leg 0.03, n=9).\\n- after-final run_id 2025-12-17T092503.187_0000: live-delete opt_avg 0.0472s vs leg_avg 1.7635s (opt/leg 0.03, n=9, git=88ad6ea clean).\\n\\nVerification:\\n- xcodebuild Lexical-Package test (iPhone 17 Pro, iOS 26.0) PASS\\n- Playground build PASS","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:50:25.033678-08:00","updated_at":"2025-12-17T01:26:43.743908-08:00","closed_at":"2025-12-17T01:26:43.743908-08:00","close_reason":"Completed (delete-block parity + major perf win); benchmarks recorded; iOS sim tests + Playground build pass","dependencies":[{"issue_id":"lexical-ios-u7r.7","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:25.034059-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.8","title":"Strategy: reduce TextStorage mutations (batch inserts/deletes/attrs)","description":"Audit optimized reconciler instruction application; look for opportunities to coalesce adjacent delete/insert/attribute operations and reduce attributed string churn.","notes":"Changes:\\n- TextStorage now tracks editingDepth to avoid nested beginEditing/endEditing in batched update paths (e.g., OptimizedReconciler modern batching).\\n- replaceCharacters(in:with:) now calls showPlaceholderText only on empty\u003c-\u003enon-empty transitions; setAttributes no longer calls showPlaceholderText.\\n\\nPerf (MixedDocumentLiveBenchmarkTests via scripts/benchmarks.py):\\n- baseline run_id 2025-12-17T071736.435_0000\\n  - live-insert opt 1.1878s vs leg 1.7005s\\n  - live-text opt 0.0601s vs leg 0.3424s\\n  - live-typing opt 0.5621s vs leg 1.2362s\\n- after   run_id 2025-12-17T072105.648_0000\\n  - live-insert opt 1.1243s vs leg 1.2297s\\n  - live-text opt 0.0538s vs leg 0.3284s\\n  - live-typing opt 0.5334s vs leg 1.1367s\\n\\nNotes: improvements apply to both optimized and legacy since they share TextStorage.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T15:50:30.337856-08:00","updated_at":"2025-12-16T23:25:25.703984-08:00","closed_at":"2025-12-16T23:25:25.703984-08:00","close_reason":"Batch-aware TextStorage editing + reduced placeholder churn; benchmarks recorded","dependencies":[{"issue_id":"lexical-ios-u7r.8","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T15:50:30.338253-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-u7r.9","title":"Strategy: reduce cachedDFSOrder work (avoid invalidation + cache index map)","description":"Investigate removing unnecessary dfsOrderCache invalidations on non-structural edits and caching the indexOf map alongside the order to avoid O(n log n) sort + O(n) dictionary rebuild on each update.","design":"Changes:\n\n- Cached DFS order and its index map together to avoid rebuilding [NodeKey: Int] on every Fenwick shift (Editor.cachedDFSOrderAndIndex).\n- Reduced unnecessary dfsOrderCache invalidations for non-structural edits (text-only, pre/post attrs-only, and central aggregation paths).\n- Moved DFS-order invalidation to structural mutation points (insert-block success, reorder fast path, coalesced replace, prune helpers, fresh hydration + slow path).\n- Ensured correctness for delete-block Fenwick shifting by capturing DFS order/index before pruning removed keys, then applying shifts after prune.\n- Invalidate DFS caches when Editor.featureFlags is reassigned (Playground flag toggles).\n\nKey files:\n- Lexical/Core/Editor.swift\n- Lexical/Core/OptimizedReconciler.swift\n\nVerification:\n- xcodebuild -workspace Playground/LexicalPlayground.xcodeproj/project.xcworkspace -scheme Lexical-Package -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' test\n- xcodebuild -project Playground/LexicalPlayground.xcodeproj -scheme LexicalPlayground -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.0' build","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T16:23:28.998704-08:00","updated_at":"2025-12-16T17:14:48.175737-08:00","closed_at":"2025-12-16T17:14:48.175737-08:00","close_reason":"Completed","dependencies":[{"issue_id":"lexical-ios-u7r.9","depends_on_id":"lexical-ios-u7r","type":"parent-child","created_at":"2025-12-16T16:23:28.999378-08:00","created_by":"daemon"},{"issue_id":"lexical-ios-u7r.9","depends_on_id":"lexical-ios-u7r.5","type":"discovered-from","created_at":"2025-12-16T16:23:28.999968-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-v5o","title":"AppKit: show pointing-hand cursor over link ranges","description":"STTextViewAppKit's STTextView.resetCursorRects enumerates .link (and .cursor) attributes in the viewport and adds NSCursor.pointingHand / custom cursors. Our Sources/LexicalAppKit/TextView+Mouse.swift resetCursorRects currently adds only an I-beam for the entire bounds. Add per-range cursor rects for visible link ranges (and optionally a custom .cursor attribute), ideally limited to the visible glyph/character range for performance.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:39:27.74682-08:00","updated_at":"2025-12-17T16:57:09.784007-08:00","closed_at":"2025-12-17T16:57:09.784007-08:00","close_reason":"Cursor rects show pointing-hand over visible link ranges","labels":["appkit","cursor","links"],"dependencies":[{"issue_id":"lexical-ios-v5o","depends_on_id":"lexical-ios-wrn","type":"discovered-from","created_at":"2025-12-17T16:39:27.748761-08:00","created_by":"daemon"}]}
{"id":"lexical-ios-vgc","title":"AppKit: Cmd+Shift+Arrow selection ignored on first press","description":"Cmd+Shift+Arrow navigation/selection (e.g. Cmd+Shift+Left) can be ignored on the first press after typing in LexicalAppKit TextViewAppKit.","notes":"Fix: route all .command-modified keyDown events through interpretKeyEvents, and treat nil inputContext.handleEvent as not handled. Add regression test AppKitCommandShiftArrowSelectionTests. Verify via xcodebuild -destination 'platform=macOS' -only-testing:LexicalTests/AppKitCommandShiftArrowSelectionTests.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T20:08:48.91683-08:00","updated_at":"2025-12-17T20:09:32.681045-08:00","closed_at":"2025-12-17T20:09:32.681045-08:00","close_reason":"Fixed command-modified keyDown handling and added regression test"}
{"id":"lexical-ios-wfq","title":"Audit and remove emoji-prefixed debug logs","description":"Search for leftover debug logging thatâ€™s prefixed with emojis (e.g. ðŸ”¥) in app/library code and remove it (or gate behind verbose logging/DEBUG where appropriate).\\n\\nInitial grep: there are ðŸ”¥ prints in e.g. Playground/LexicalPlayground/ToolbarPlugin.swift, Lexical/LexicalView/LexicalView.swift, Lexical/Core/Selection/RangeSelection.swift, Sources/LexicalAppKit/*, Lexical/Helper/ReconcilerShadowCompare.swift.","acceptance_criteria":"No emoji-prefixed debug logs remain in production code (Playground/, Lexical/, Plugins/, Sources/) unless explicitly gated for diagnostics. iOS Simulator tests (Lexical-Package) and Playground build both pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T17:28:07.876511-08:00","updated_at":"2025-12-15T20:24:21.680267-08:00","closed_at":"2025-12-15T20:24:21.680267-08:00","close_reason":"Removed emoji-prefixed debug logs/print statements; iOS simulator test suite + Playground build pass"}
{"id":"lexical-ios-wrn","title":"Research: Review ../STTextView AppKit implementation for copy/paste + layout/flicker lessons","description":"Compare our LexicalAppKit text view integration against ../STTextView (AppKit). Look for patterns that solve: (1) copy/paste key equivalents and menu validation, (2) non-contiguous layout / flicker while typing, (3) incremental editing vs full-range edits, (4) selection synchronization edge cases. Create follow-up bd issues for any specific behaviors we should port.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:24:14.737966-08:00","updated_at":"2025-12-17T16:40:32.747901-08:00","closed_at":"2025-12-17T16:40:32.747901-08:00","close_reason":"Created follow-up issues from STTextView review","dependencies":[{"issue_id":"lexical-ios-wrn","depends_on_id":"lexical-ios-u7r.25","type":"discovered-from","created_at":"2025-12-17T16:24:14.739397-08:00","created_by":"mh"}],"comments":[{"id":4,"issue_id":"lexical-ios-wrn","author":"mh","text":"Reviewed ../STTextView (AppKit) for portable editor behaviors. Key takeaways: cursor rects for links/custom cursors; hitTest pass-through so overlay subviews donâ€™t steal focus; defensive NSTextInputClient range handling for IME; broader marked-text attributes (markedClauseSegment / replacement-range); legacy pasteboard type strings used by Services; longer-term option of a TextKit2 backend. Created follow-ups: lexical-ios-v5o, lexical-ios-3kx, lexical-ios-sxu, lexical-ios-t1t, lexical-ios-zvq, lexical-ios-obz.","created_at":"2025-12-18T00:40:28Z"}]}
{"id":"lexical-ios-zvq","title":"AppKit clipboard/services: handle legacy pasteboard types (NSStringPboardType/NSRTFPboardType)","description":"STTextViewAppKit's NSServicesMenuRequestor handles legacy raw pasteboard type strings that appear in the wild (e.g. NSStringPboardType, NSRTFPboardType) and uses UTType checks. Audit Sources/LexicalAppKit/CopyPasteHelpers.swift to ensure we can read/write selection for these legacy types too (especially when invoked via Services).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T16:40:01.550777-08:00","updated_at":"2025-12-17T16:56:53.663984-08:00","closed_at":"2025-12-17T16:56:53.663984-08:00","close_reason":"Support legacy NSStringPboardType/NSRTFPboardType/NSRTFDPboardType on paste","labels":["appkit","clipboard"],"dependencies":[{"issue_id":"lexical-ios-zvq","depends_on_id":"lexical-ios-wrn","type":"discovered-from","created_at":"2025-12-17T16:40:01.552417-08:00","created_by":"daemon"}]}
